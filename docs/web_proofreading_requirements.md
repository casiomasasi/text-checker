# Webベーステキスト校正システム要件定義

## 概要
Wordファイルをアップロードし、Googleドキュメント風のWebインターフェースで校正結果を確認・適用できるシステム。

## 機能要件

### 1. ファイルアップロード機能
- **対応形式**: .docx, .doc ファイル
- **アップロード方式**: ドラッグ&ドロップ または ファイル選択ボタン
- **プログレス表示**: アップロード進捗の視覚的表示
- **ファイルサイズ制限**: 最大10MB
- **エラーハンドリング**: 不正なファイル形式の検出とエラー表示

### 2. Wordファイル処理機能
- **テキスト抽出**: .docx/.doc からプレーンテキストを抽出
- **書式保持**: 段落、改行、基本的な構造を保持
- **メタデータ取得**: ファイル名、サイズ、作成日時など
- **エンコーディング対応**: 日本語文字の正確な処理

### 3. 校正エンジン統合
- **既存校正機能**: 誤字脱字、不適切表現、文脈整合性チェック
- **リアルタイム処理**: ファイルアップロード後の即座な校正実行
- **エラー位置特定**: 文字レベルでの正確な位置特定
- **重要度分類**: High/Medium/Lowでの問題分類

### 4. Googleドキュメント風エディタ
- **リッチテキストエディタ**: 編集可能なテキストエディタ
- **レスポンシブデザイン**: 様々な画面サイズに対応
- **フォント設定**: Noto Sans JP等の日本語対応フォント
- **ツールバー**: 基本的な編集機能（太字、斜体、下線等）

### 5. コメントシステム
- **視覚的表示**: 指摘箇所をハイライト表示
- **コメントバルーン**: 右側にコメント表示領域
- **重要度色分け**: 
  - High: 赤色背景
  - Medium: 黄色背景
  - Low: 青色背景
- **修正案表示**: 具体的な改善提案を表示

### 6. キーボードナビゲーション
- **十字キー移動**: ↑↓キーでコメント間移動
- **Tab移動**: Tabキーでコメント要素間移動
- **Enter承諾**: Enterキーでコメント承諾・適用
- **Escape取消**: Escキーでコメント無視
- **ショートカット表示**: ヘルプモーダルでキー操作説明

### 7. コメント承諾・反映機能
- **1クリック適用**: マウスクリックで修正案適用
- **元に戻す機能**: Ctrl+Zで変更を元に戻す
- **変更履歴**: 適用した修正の履歴表示
- **一括適用**: 全ての修正案を一括適用する機能

### 8. ダウンロード機能
- **修正版テキスト**: 修正が適用されたテキストファイル
- **校正レポート**: Excel形式での詳細レポート
- **変更サマリー**: 適用した修正内容のサマリー

## 技術仕様

### フロントエンド
- **HTML5 + CSS3**: モダンなWeb標準
- **JavaScript (ES6+)**: インタラクティブ機能
- **ライブラリ**: 
  - TinyMCE または Quill.js (リッチテキストエディタ)
  - Font Awesome (アイコン)
- **レスポンシブフレームワーク**: Bootstrap 5

### バックエンド
- **Python Flask**: Webアプリケーションフレームワーク
- **python-docx**: Wordファイル処理
- **既存校正エンジン**: 既に実装された校正機能を活用
- **RESTful API**: JSON形式でのデータ交換

### API設計
```
POST /api/upload           # ファイルアップロード
GET  /api/status/{id}      # 処理状況確認
POST /api/proofread        # 校正実行
POST /api/apply-fix        # 修正適用
GET  /api/download/{id}    # ファイルダウンロード
```

### データ構造
```json
{
  "document": {
    "id": "uuid",
    "original_text": "...",
    "current_text": "...",
    "metadata": {...}
  },
  "comments": [
    {
      "id": "comment_1",
      "position": {"start": 10, "end": 15},
      "type": "typo_error",
      "severity": "high",
      "original": "誤字",
      "suggestion": "正字",
      "description": "説明文",
      "applied": false
    }
  ]
}
```

## UI/UX設計

### レイアウト構成
```
+----------------------------------+
|         ヘッダー (ツールバー)        |
+----------------------------------+
|  エディタ領域    |   コメント領域   |
|                 |               |
|  [テキスト本文]  |  [コメント一覧] |
|                 |               |
|                 |               |
+----------------------------------+
|         フッター (ステータス)        |
+----------------------------------+
```

### インタラクション設計
1. **ファイルアップロード**
   - ドラッグ&ドロップエリア
   - プログレスバー表示
   - 成功/エラーメッセージ

2. **校正結果表示**
   - アニメーション付きハイライト
   - 段階的なコメント表示
   - スムーズなスクロール

3. **コメント操作**
   - ホバーエフェクト
   - クリック可能な視覚的フィードバック
   - 適用時のアニメーション

### アクセシビリティ
- **キーボード操作**: 全機能をキーボードで操作可能
- **スクリーンリーダー対応**: 適切なARIA属性
- **コントラスト比**: WCAG 2.1 AA準拠
- **フォーカス表示**: 明確なフォーカスインジケーター

## 非機能要件

### パフォーマンス
- **ファイル処理**: 1MB以下のファイルを5秒以内で処理
- **リアルタイム応答**: UI操作の応答時間200ms以内
- **メモリ使用量**: ブラウザメモリ使用量100MB以内

### セキュリティ
- **ファイル検証**: アップロードファイルの安全性チェック
- **CSRF対策**: Cross-Site Request Forgery防止
- **入力サニタイズ**: XSS攻撃の防止
- **ファイル削除**: 処理後の一時ファイル自動削除

### 互換性
- **ブラウザ対応**: Chrome, Firefox, Safari, Edge (最新2バージョン)
- **OS対応**: Windows, macOS, Linux
- **モバイル対応**: タブレット・スマートフォンでの基本操作

## 開発フェーズ

### Phase 1: 基本機能
- ファイルアップロード
- 基本的な校正機能
- シンプルなエディタ表示

### Phase 2: インタラクション
- コメント表示・適用機能
- キーボードナビゲーション
- 基本的なUI/UX

### Phase 3: 高度な機能
- リッチテキストエディタ
- 詳細な変更履歴
- エクスポート機能

### Phase 4: 最適化
- パフォーマンス改善
- アクセシビリティ向上
- モバイル対応強化